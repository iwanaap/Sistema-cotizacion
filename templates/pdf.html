<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cotización PDF</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      margin: 20px;
      font-size: 1.1rem;
    }
    .table th, .table td {
      border: 1px solid #dee2e6;
    }
    .header, .section-header {
      background-color: #f8f9fa;
      padding: 10px;
      margin-bottom: 20px;
    }
    /* Opcional: estilos para forzar anchos fijos en la tabla */
    .col-producto { width: 35%; }
    .col-cantidad { width: 10%; }
    .col-formato { width: 10%; }
    .col-precio, .col-subtotal { width: 15%; }
    .col-img { width: 20%; }
  </style>
</head>
<body class="container">
  {# Macro para formatear montos: sin decimales, separador de miles con punto y anteponer "$" #}
  {% macro format_money(value) %}
    ${{ "{:,.0f}".format(value).replace(',', '.') }}
  {% endmacro %}

  <!-- Encabezado de la cotización -->
  <div class="header d-flex align-items-center justify-content-between" style="background-color: #122964; padding: 15px;">
    <!-- Logo Izquierdo -->
    <div class="logo-left">
      <a href="" target="_blank"><img src="{{ cotizacion.img_logo_izquierdo }}" alt="Logo Izquierdo" style="max-height: 80px;"></a>
    </div>
    
    <!-- Texto centrado -->
    <div class="text-center flex-grow-1">
      <h1 class="text-white mb-0">Cotización Nº {{ cotizacion.numero_cotizacion }}</h1>
      <p class="text-white mb-0"><strong>Fecha:</strong> {{ cotizacion.fecha }}</p>
    </div>
    
    <!-- Logo Derecho -->
    <div class="logo-right">
      <a href="" target="_blank"><img src="{{ cotizacion.img_logo_derecho }}" alt="Logo Derecho" style="max-height: 80px;"></a>
    </div>
  </div>
  

  <div class="row mb-4">
    <!-- Bloque para Datos del Cliente/Empresa (Izquierda) -->
    <div class="col-6">
      <div class="border p-3">
        <h4>Datos del Cliente/Empresa</h4>
        <p><strong>Contacto:</strong> {{ cotizacion.contacto }}</p>
        <p><strong>Empresa:</strong> {{ cotizacion.empresa }}</p>
        <p><strong>RUT:</strong> {{ cotizacion.rut }}</p>
        <p><strong>Teléfono:</strong> {{ cotizacion.telefono }}</p>
        <p><strong>Email:</strong> {{ cotizacion.email }}</p>
      </div>
    </div>
  
    <!-- Bloque para Datos de Nuestra Empresa (Derecha) -->
    <div class="col-6">
      <div class="border p-3">
        <p><strong>Razón Social:</strong> NELSON ISIDORO LANDAETA LILLO A.D.P. SEGURIDAD E.I.R.L.</p>
        <p><strong>RUT:</strong> 76.380.279-5</p>
        <p><strong>Dirección:</strong> PADRE JAIME LARRAIN HURTADO 206, ESTACIÓN CENTRAL</p>
        <p>
          <strong>Teléfono:</strong>
          <a href="tel:+56982375153">+569 8237 5153</a> -
          <a href="tel:+56934821394">+569 34821394</a>
        </p>
        
      </div>
    </div>
  </div>

  <!-- Detalle de Productos -->
  <div>
    <div class="section-header">
      <h4>Productos</h4>
    </div>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Imagen</th>
          <th class="col-producto">Producto</th>
          <th class="col-cantidad">Cantidad</th>
          <th class="col-formato">Formato</th>
          <th class="col-precio">Precio</th>
          <th class="col-subtotal">Subtotal</th>
        </tr>
      </thead>
      <tbody>
        {% for producto in cotizacion.productos %}
        <tr>
          <td class="col-img" style="width: 100px; text-align: center;">
            {% if producto.imagen %}
              <img src="file:///{{ os.path.abspath(os.path.join('static', 'img', 'productos', producto.imagen)) }}" alt="Imagen del producto" style="max-width: 80px; max-height: 80px;">
            {% endif %}
          </td>
          <td class="col-producto">{{ producto.producto }}</td>
          <td class="col-cantidad">{{ producto.cantidad }}</td>
          <td class="col-formato">{{ producto.formato }}</td>
          <td class="col-precio">{{ format_money(producto.precio|float) }}</td>
          <td class="col-subtotal">{{ format_money(producto.subtotal|float) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Calcular totales con Jinja usando namespace -->
  {% set ns = namespace(totalNeto=0) %}
  {% for producto in cotizacion.productos %}
    {% set ns.totalNeto = ns.totalNeto + (producto.subtotal|float) %}
  {% endfor %}
  {% set iva = ns.totalNeto * 0.19 %}
  {% set total = ns.totalNeto + iva %}

  <!-- Resumen de Cotización -->
  <div class="mb-3">
    <h5>Resumen de Cotización</h5>
    <div class="d-flex justify-content-between">
        <span>Total Neto:</span>
        <span>{{ format_money(ns.totalNeto) }}</span>
    </div>
    <div class="d-flex justify-content-between">
        <span>IVA (19%):</span>
        <span>{{ format_money(iva) }}</span>
    </div>
    <div class="d-flex justify-content-between">
        <span>Total:</span>
        <span>{{ format_money(total) }}</span>
    </div>
  </div>

  <!-- Datos condiciones -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="section-header">
        <h4>Condiciones</h4>
      </div>
      <p><strong>Plazo de entrega:</strong> {{ cotizacion.plazo_entrega }}</p>
      <p><strong>Forma de pago:</strong> {{ cotizacion.forma_pago }}</p>
    </div>
  </div>

  <p class="mt-4">
    <strong>Datos Cuenta Bancaria:</strong>
    BANCO ESTADO   CTA VISTA / CHEQUERA ELECTRÓNICA   N.º de cuenta: 26170073214   RUT: 76.380.279-5   Nombre: NELSON LANDAETA LILLO ADPSEGURIDAD EIRL   Correo: ventas@abordar.cl 
  </p>

  <!-- Pie de página -->
  <div class="text-center">
    <p>Esta cotización es válida por 30 días.</p>
  </div>
    <!-- Footer -->
    <!-- Footer compacto -->
  <footer class="py-3">
    <!-- Asegúrate de tener Bootstrap cargado -->
    <div class="section-header d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Conoce nuestro trabajo</h4>
      <a href="https://www.instagram.com/abordar.cl" target="_blank" aria-label="Instagram">
        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 32 32">
          <path d="M 11.46875 5 C 7.917969 5 5 7.914063 5 11.46875 L 5 20.53125 C 5 24.082031 7.914063 27 11.46875 27 L 20.53125 27 C 24.082031 27 27 24.085938 27 20.53125 L 27 11.46875 C 27 7.917969 24.085938 5 20.53125 5 Z M 11.46875 7 L 20.53125 7 C 23.003906 7 25 8.996094 25 11.46875 L 25 20.53125 C 25 23.003906 23.003906 25 20.53125 25 L 11.46875 25 C 8.996094 25 7 23.003906 7 20.53125 L 7 11.46875 C 7 8.996094 8.996094 7 11.46875 7 Z M 21.90625 9.1875 C 21.402344 9.1875 21 9.589844 21 10.09375 C 21 10.597656 21.402344 11 21.90625 11 C 22.410156 11 22.8125 10.597656 22.8125 10.09375 C 22.8125 9.589844 22.410156 9.1875 21.90625 9.1875 Z M 16 10 C 12.699219 10 10 12.699219 10 16 C 10 19.300781 12.699219 22 16 22 C 19.300781 22 22 19.300781 22 16 C 22 12.699219 19.300781 10 16 10 Z M 16 12 C 18.222656 12 20 13.777344 20 16 C 20 18.222656 18.222656 20 16 20 C 13.777344 20 12 18.222656 12 16 C 12 13.777344 13.777344 12 16 12 Z"></path>
        </svg>
      </a>
    </div>

    <div class="container text-center footer-links">
      <ul class="list-inline mb-0">
        <li class="list-inline-item mx-2">
          <a href="#" target="_blank" class="text-decoration-none">Papelería e Imprenta</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="https://abordar.cl/bordados/" target="_blank" class="text-decoration-none">Bordado Industrial</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="https://abordar.cl/estampados-impresion-directa-dtg/" target="_blank" class="text-decoration-none">DTG (Impresión Directa)</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="#" target="_blank" class="text-decoration-none">Ropa Corporativa</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="#" target="_blank" class="text-decoration-none">Grifería</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="#" target="_blank" class="text-decoration-none">Seguridad Vial</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="#" target="_blank" class="text-decoration-none">Sublimación</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="#" target="_blank" class="text-decoration-none">Estampados DTF</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="#" target="_blank" class="text-decoration-none">Asesoría en Compras</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="#" target="_blank" class="text-decoration-none">Guante Alta Temperatura</a>
        </li>
        <li class="list-inline-item mx-2">
          <a href="#" target="_blank" class="text-decoration-none">EPP</a>
        </li>
      </ul>
    </div>
  </footer>
  <style>
    .footer-links a {
      color: #112863;   
      text-decoration: none;
    }
    .footer-links a:hover {
      text-decoration: underline;
    }
  </style>
</body>
</html>
